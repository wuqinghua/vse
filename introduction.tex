%!TEX root = main.tex

\section{Introduction}
\label{sec:intro}

Voice search service has become popular over the last few years due to its convenience on mobile devices. A recent report showed that more than half of teens use voice search more than once a day~\cite{voice_search_report}. A voice search session consists of two successive phases: voice recognition and web search. First, the mobile terminal transmits the speech data to a voice recognition server and gets the recognized keyword(s). After that, the mobile terminal queries the keyword(s) and obtains the search results. The two phases are carried out across two independent flows, established to different servers. One of the flows is uploading data (voice search), the other is downloading data (web search result), and both flows are short (less than 100 packets).

In this paper, we are motivated by the fact that the latency and packet loss rates in mobile and wireless network are able to significantly degrade user-perceived performance in such voice search service. There is already a large body of work \cite{sommers2012cell,yu2014can,chen2012network,sharma2010goodput} studying the impact of network quality on user perceived performance of mobile applications. However, most of them focus on the downloading efficiency of relatively long flows in wireless and mobile network, which is not applicable to the voice search service, which contains mostly short flows, both in the upload and download directions. The complexity and uniqueness of voice search is a great opportunity to better understand the user-perceived performance in this type of traffic.

To this end, we obtained a unique dataset from voice search servers in one of the top 3 search service providers in China. The dataset spans over two weeks in April 2015, consisting of about 1 million voice recognition flows and 3 million web search flows from 3G and WiFi network, in the usual pcap format. We break down the analysis into two independent segments: voice recognition (Section~\ref{sec:voice}) and web search (Section~\ref{sec:web_search}), with emphasis on the disparity that might exist when accessing using 3G and WiFi connection. In each part, we analyze the network-related finish time of flows, and in particular the impact of TCP performance factors (i.e. RTT, packet loss/disordering, timeout retransmission) on the finish time. However, as we observe flows from the server-side, we do not have visibility of when the clients sent their TCP segments. Therefore, we propose heuristics to estimate the TCP performance factors. On the other hand, we can collect the information of all the TCP performance factors for web search flows, and thus partition a web search flow into three TCP stages: 3-way handshake, slow start, and congestion avoidance. We then examine the impact of the three stages on the finish time, and inspect the key performance parameters in each stage. Our main observations are the following:

%We focus on the disparity that might exist between TCP upload and download flows and also the possible difference when searching using 3G and WiFi connection. In particular, we analyzed timeout retransmission, an expensive operation for packet loss recovery as it dominates the finish time once it happens. We have made several key observations , which constitute valuable insights for improving the user-perceived performance in voice search service.


\begin{itemize}
\item Flows in both voice recognition and web search are short (no more than 4 packets and 100 packets respectively). Despite the small flow size, there are outlier flows experiencing extremely long finish time. For instance, we observe that 10\% of WiFi flows in voice recognition spend more than 0.5 second for voice data uploading, and 20\% of WiFi flows in web search cannot finish the search result transmission within 1 second.

\item The finish time in both voice recognition and web search is proportional to RTT when there is no packet loss. RTT however exhibits a large variation, especially in WiFi network. We observe the RTT of WiFi flows ranges from 10 ms to 400 ms with a median around 40 ms. 

\item For those flows with packet loss, the finish time is dominated by the the time for loss recovery operations, especially by timeout retransmissions. We observe that WiFi flows are more likely to suffer from timeout retransmission than 3G flows due to the higher packet loss rate (3\% in WiFi vs 0.9\% in 3G). The timeout retransmissions can even happen during connection establishment, leading to an extremely large finish time.

\item We classify timeout retransmission in web search flows into four types based on how they are triggered. Tail retransmission is the most common type in both WiFi flows (38.3\%) and 3G flows (69.6\%). However, double retransmission and packet delay retransmission are more likely to happen in WiFi flows (33.8\% and 27.4\% in WiFi versus 13.5\% and 16.1\% in 3G).

\end{itemize}

Our findings highlight the impact of TCP performance factors on the flow finish time in this peculiar but increasingly popular service. We believe that these findings provide valuable insights into the design of voice search service, the optimizations of TCP protocol for short flows of both upload and download, middlebox diagnosis, and their interactions.

The remaining of this paper is organized as follows. Section~\ref{sec:dataset} describes the dataset. Section~\ref{sec:voice} and Section~\ref{sec:web_search} carry out an in-depth analysis on the performance of voice recognition and web search separately, and inspect the performance causes. Section~\ref{sec:discuss} discusses the implication of the observations and the possible shortcomings of this work. Section~\ref{sec:related} compares the related work and Section~\ref{sec:conclude} concludes our work. 
